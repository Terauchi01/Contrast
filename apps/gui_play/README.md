# Human vs AI GUI

学習済みのN-tuple AIと対戦できるGUIアプリケーションです。

## 起動方法

### 簡単な方法（スクリプト使用）

```bash
./scripts/play_vs_ai.sh
```

これで、`ntuple_weights_vs_greedy.bin.100000` の重みを使ってAIと対戦できます。

### 手動で起動

```bash
cd build/apps/gui_play
./gui_play <weights_file_path>
```

例：
```bash
cd build/apps/gui_play
./gui_play ../train_ntuple/ntuple_weights_vs_greedy.bin.100000
```

## 遊び方

### ゲームの流れ

プレイは4つのステップで進みます：

1. **駒の選択 (Step 1)**: 自分の駒（デフォルトでは黒）をクリックして選択
   - 選択された駒は黄色い枠で表示されます
   
2. **移動先の選択 (Step 2)**: 移動可能なマス（緑色の枠）をクリック
   - 移動可能なマスが緑色にハイライトされます
   - 選択した移動先はオレンジ色の枠で表示されます
   
3. **タイルの種類選択 (Step 3)**: サイドバーのボタンでタイルを選択
   - **Black Tile**: 直交方向（上下左右）のみ移動可能なタイル
   - **Gray Tile**: すべての方向（直交+対角）に移動可能なタイル
   - **Skip (no tile)**: タイルを配置せず移動のみ
   
4. **タイル配置場所の選択 (Step 4)**: タイルを配置する空きマスをクリック
   - 配置可能な空きマスが青色にハイライトされます
   - タイルを選択した場合のみこのステップが表示されます

各ステップで「Cancel」ボタンを押すと、最初からやり直せます。

### タイルの使い方

- **タイルは空のマスにのみ配置できます**
- タイルを配置すると、そのマスから移動できる方向が変わります
- タイルの残り数は限られているので、戦略的に使いましょう
- 「Skip」を選択すれば、タイルを使わずに移動だけすることも可能です

### UI説明

- **サイドバー**（左側）
  - プレイヤー情報（人間/AI）
  - 現在のターン
  - 残りタイル数
  - **ステップガイド**（現在のフェーズに応じて表示）
    - Step 1: 駒を選択する指示
    - Step 2: 移動先を選択する指示
    - Step 3: タイル選択ボタン（Black/Gray/Skip）
    - Step 4: タイル配置場所を選択する指示
  - Cancelボタン（各ステップで利用可能）
  - ゲームコントロールボタン
  - 操作説明

- **ボードエリア**（右側）
  - 5x5の盤面
  - 五角形が駒を表す
    - 黒い五角形: 黒の駒
    - 白い五角形: 白の駒
  - マスの色がタイルの種類を示す
    - 明るいグレー: タイルなし
    - 濃いグレー: 黒タイル
    - 中間グレー: 灰色タイル
  - 矢印がそのマスから移動可能な方向を示す
  - **ハイライト**
    - 黄色の枠: 選択中の駒
    - オレンジの枠: 選択した移動先
    - 緑の枠: 移動可能なマス（Step 2）
    - 青の枠: タイル配置可能なマス（Step 4）

### ボタン

- **New Game**: ゲームをリセットして新しく始める
- **Switch Colors**: 人間とAIの色を入れ替える（黒⇔白）

## 勝利条件

- 相手の駒を1個以下にする
- 相手が合法手を打てなくなる

## ビルド方法

```bash
cd build
cmake ..
make gui_play -j4
```

## AIについて

このGUIは複数種類のAIと対戦できます。

- **Greedy**: ローカル評価で即時の得を狙うシンプル方策
- **RuleBased**: 旧来のヒューリスティックベースAI
- **RuleBasedPolicy2**: 6段階の戦術（パリティ制御、列破壊など）を実装した最新版ルールベースAI
- **N-tuple Network**: 学習済み重み `ntuple_weights_vs_greedy.bin.100000` を読み込み、局所パターン評価で手を選択

N-tuple AIに関する詳細:

- **使用する重みファイル**: `ntuple_weights_vs_greedy.bin.100000`
- **学習方法**: Greedy方策と10万ゲーム対戦して学習
- **評価方法**: 盤面の局所パターン（N-tuple）を評価して手を選択

## トラブルシューティング

### GUIが起動しない

macOSでSSH接続している場合、GUIは表示できません。ローカル環境で実行してください。

### 重みファイルが見つからない

先に学習を実行してください：

```bash
cd build/apps/train_ntuple
./train_ntuple --load ntuple_weights.bin.100000 --games 100000 --opponent greedy --epsilon 0.2 --save-interval 10000 --output ntuple_weights_vs_greedy.bin
```

### コンパイルエラー

依存関係を確認してください：
- CMake 3.14以上
- C++17対応コンパイラ
- OpenGL
- GLFW（自動ダウンロード）
- ImGui（自動ダウンロード）

## 技術詳細

- **グラフィックス**: ImGui + OpenGL + GLFW
- **AI**: N-tuple Network (Temporal Difference Learning)
- **プログラミング言語**: C++17
